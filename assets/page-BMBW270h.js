import{a as e,s as a,j as r}from"./index-BH-fJ4Ku.js";import{u as t,c as s}from"./react-vendor-Bx1kqAC_.js";import"./supabase-vendor-Bh6n7b__.js";const l=[{code:"PT",name:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"ES",name:"Espanha",flag:"ðŸ‡ªðŸ‡¸"},{code:"FR",name:"FranÃ§a",flag:"ðŸ‡«ðŸ‡·"},{code:"DE",name:"Alemanha",flag:"ðŸ‡©ðŸ‡ª"},{code:"IT",name:"ItÃ¡lia",flag:"ðŸ‡®ðŸ‡¹"},{code:"UK",name:"Reino Unido",flag:"ðŸ‡¬ðŸ‡§"},{code:"NL",name:"Holanda",flag:"ðŸ‡³ðŸ‡±"},{code:"BE",name:"BÃ©lgica",flag:"ðŸ‡§ðŸ‡ª"},{code:"AT",name:"Ãustria",flag:"ðŸ‡¦ðŸ‡¹"},{code:"CH",name:"SuÃ­Ã§a",flag:"ðŸ‡¨ðŸ‡­"},{code:"IE",name:"Irlanda",flag:"ðŸ‡®ðŸ‡ª"},{code:"DK",name:"Dinamarca",flag:"ðŸ‡©ðŸ‡°"},{code:"SE",name:"SuÃ©cia",flag:"ðŸ‡¸ðŸ‡ª"},{code:"NO",name:"Noruega",flag:"ðŸ‡³ðŸ‡´"},{code:"FI",name:"FinlÃ¢ndia",flag:"ðŸ‡«ðŸ‡®"},{code:"PL",name:"PolÃ³nia",flag:"ðŸ‡µðŸ‡±"},{code:"CZ",name:"RepÃºblica Checa",flag:"ðŸ‡¨ðŸ‡¿"},{code:"GR",name:"GrÃ©cia",flag:"ðŸ‡¬ðŸ‡·"},{code:"HU",name:"Hungria",flag:"ðŸ‡­ðŸ‡º"},{code:"RO",name:"RomÃ©nia",flag:"ðŸ‡·ðŸ‡´"}];function d(){const d=t(),{items:i,cartTotal:o,clearCart:n}=e(),[c,x]=s.useState(!1),[m,p]=s.useState(!1),[g,h]=s.useState([]),[u,b]=s.useState(""),[y,f]=s.useState(0),[j,N]=s.useState({fullName:"",email:"",phone:"",address:"",city:"",postalCode:"",country:"PT",paymentMethod:"card",cardNumber:"",cardExpiry:"",cardCVV:""}),k=()=>i.reduce((e,a)=>e+(a.weight||.5)*a.quantity,0);s.useEffect(()=>{j.country&&v()},[j.country]),s.useEffect(()=>{u&&w()},[u,i]);const v=async()=>{try{p(!0);const{data:e,error:r}=await a.from("shipping_rules").select("*").eq("country_code",j.country).eq("active",!0).order("priority",{ascending:!0});if(r)throw r;h(e||[]),e&&e.length>0?b(e[0].id):(b(""),f(0))}catch(e){h([]),b(""),f(0)}finally{p(!1)}},w=()=>{const e=g.find(e=>e.id===u);if(!e)return void f(0);if(e.free_shipping_threshold&&o>=e.free_shipping_threshold)return void f(0);let a=e.base_cost;if(e.weight_based){a+=k()*e.cost_per_kg}f(a)},_=e=>{N({...j,[e.target.name]:e.target.value})},C=g.find(e=>e.id===u),E=k(),F=o+y,S=C?.free_shipping_threshold&&o>=C.free_shipping_threshold;return 0===i.length?r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pt-24 pb-12",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"text-center py-16",children:[r.jsx("i",{className:"ri-shopping-cart-line text-6xl text-gray-300 dark:text-gray-600 mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Carrinho Vazio"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Adicione produtos ao carrinho para continuar"}),r.jsx("button",{onClick:()=>d("/category"),className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-200",children:"Ver Produtos"})]})})}):r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pt-24 pb-12",children:r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-8",children:"Finalizar Compra"}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),0!==i.length)if(u){x(!0);try{const{data:e}=await a.auth.getUser(),r={user_id:e.user?.id||null,customer_name:j.fullName,customer_email:j.email,customer_phone:j.phone,shipping_address:j.address,shipping_city:j.city,shipping_postal_code:j.postalCode,shipping_country:j.country,payment_method:j.paymentMethod,subtotal:o,shipping_cost:y,total:o+y,status:"pending",shipping_method:g.find(e=>e.id===u)?.name||"Standard"},{data:t,error:s}=await a.from("orders").insert([r]).select().single();if(s)throw s;const l=i.map(e=>({order_id:t.id,product_id:e.id,product_name:e.name,quantity:e.quantity,price:e.price,subtotal:e.price*e.quantity})),{error:c}=await a.from("order_items").insert(l);if(c)throw c;n(),alert("âœ… Pedido realizado com sucesso!"),d("/profile")}catch(r){alert("âŒ Erro ao processar pedido. Tente novamente.")}finally{x(!1)}}else alert("âš ï¸ Por favor, selecione uma opÃ§Ã£o de envio!");else alert("âš ï¸ Seu carrinho estÃ¡ vazio!")},className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[r.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("i",{className:"ri-user-line text-purple-600"}),"InformaÃ§Ãµes Pessoais"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Nome Completo *"}),r.jsx("input",{type:"text",name:"fullName",value:j.fullName,onChange:_,required:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Email *"}),r.jsx("input",{type:"email",name:"email",value:j.email,onChange:_,required:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Telefone *"}),r.jsx("input",{type:"tel",name:"phone",value:j.phone,onChange:_,required:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[r.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("i",{className:"ri-map-pin-line text-purple-600"}),"EndereÃ§o de Entrega"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Morada Completa *"}),r.jsx("input",{type:"text",name:"address",value:j.address,onChange:_,required:!0,placeholder:"Rua, nÃºmero, andar, apartamento...",className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Cidade *"}),r.jsx("input",{type:"text",name:"city",value:j.city,onChange:_,required:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"CÃ³digo Postal *"}),r.jsx("input",{type:"text",name:"postalCode",value:j.postalCode,onChange:_,required:!0,placeholder:"1000-100",className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"PaÃ­s *"}),r.jsx("select",{name:"country",value:j.country,onChange:_,required:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500",children:l.map(e=>r.jsxs("option",{value:e.code,children:[e.flag," ",e.name]},e.code))})]})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[r.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("i",{className:"ri-truck-line text-purple-600"}),"MÃ©todo de Envio"]}),m?r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx("div",{className:"w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Carregando opÃ§Ãµes de envio..."})]}):0===g.length?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("i",{className:"ri-error-warning-line text-5xl text-yellow-500 mb-3"}),r.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Nenhuma opÃ§Ã£o de envio disponÃ­vel para ",l.find(e=>e.code===j.country)?.name]}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-2",children:"Entre em contacto connosco para verificar disponibilidade"})]}):r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("i",{className:"ri-scales-3-line text-blue-600 dark:text-blue-400"}),r.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:["Peso total do carrinho: ",r.jsxs("strong",{children:[E.toFixed(2)," kg"]})]})]})}),g.map(e=>{const a=e.base_cost+(e.weight_based?E*e.cost_per_kg:0),t=e.free_shipping_threshold&&o>=e.free_shipping_threshold,s=t?0:a;return r.jsx("label",{className:"block p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 "+(u===e.id?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("input",{type:"radio",name:"shipping",value:e.id,checked:u===e.id,onChange:e=>b(e.target.value),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-purple-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:e.name}),t?r.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-sm font-bold rounded-full",children:"ðŸŽ GRÃTIS"}):r.jsxs("span",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:["â‚¬",s.toFixed(2)]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("i",{className:"ri-time-line"}),e.min_delivery_days,"-",e.max_delivery_days," dias Ãºteis"]}),e.weight_based&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("i",{className:"ri-scales-3-line"}),"â‚¬",e.cost_per_kg.toFixed(2),"/kg"]})]}),e.free_shipping_threshold&&!t&&r.jsxs("div",{className:"mt-2 text-xs text-yellow-600 dark:text-yellow-400",children:[r.jsx("i",{className:"ri-information-line"})," Envio grÃ¡tis em compras acima de â‚¬",e.free_shipping_threshold.toFixed(2),"(faltam â‚¬",(e.free_shipping_threshold-o).toFixed(2),")"]})]})]})},e.id)})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[r.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("i",{className:"ri-bank-card-line text-purple-600"}),"MÃ©todo de Pagamento"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{className:"block p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 cursor-pointer hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"radio",name:"paymentMethod",value:"card",checked:"card"===j.paymentMethod,onChange:_,className:"w-4 h-4 text-purple-600 focus:ring-purple-500"}),r.jsx("i",{className:"ri-bank-card-line text-2xl text-gray-600 dark:text-gray-400"}),r.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"CartÃ£o de CrÃ©dito/DÃ©bito"})]})}),r.jsx("label",{className:"block p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 cursor-pointer hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"radio",name:"paymentMethod",value:"mbway",checked:"mbway"===j.paymentMethod,onChange:_,className:"w-4 h-4 text-purple-600 focus:ring-purple-500"}),r.jsx("i",{className:"ri-smartphone-line text-2xl text-gray-600 dark:text-gray-400"}),r.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"MB WAY"})]})}),r.jsx("label",{className:"block p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 cursor-pointer hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===j.paymentMethod,onChange:_,className:"w-4 h-4 text-purple-600 focus:ring-purple-500"}),r.jsx("i",{className:"ri-exchange-line text-2xl text-gray-600 dark:text-gray-400"}),r.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"TransferÃªncia BancÃ¡ria"})]})})]})]})]}),r.jsx("div",{className:"lg:col-span-1",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700 sticky top-24",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Resumo do Pedido"}),r.jsx("div",{className:"space-y-4 mb-6",children:i.map(e=>r.jsxs("div",{className:"flex gap-3",children:[r.jsx("img",{src:e.image,alt:e.name,className:"w-16 h-16 rounded-lg object-cover"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm line-clamp-1",children:e.name}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Qtd: ",e.quantity]}),r.jsxs("p",{className:"font-semibold text-purple-600 dark:text-purple-400",children:["â‚¬",(e.price*e.quantity).toFixed(2)]})]})]},e.id))}),r.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[r.jsx("span",{children:"Subtotal"}),r.jsxs("span",{className:"font-semibold",children:["â‚¬",o.toFixed(2)]})]}),r.jsxs("div",{className:"flex justify-between text-gray-600 dark:text-gray-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("i",{className:"ri-truck-line"}),"Envio"]}),S?r.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:"GRÃTIS ðŸŽ"}):y>0?r.jsxs("span",{className:"font-semibold",children:["â‚¬",y.toFixed(2)]}):r.jsx("span",{className:"text-sm",children:"Selecione"})]}),r.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 flex justify-between text-lg font-bold text-gray-900 dark:text-white",children:[r.jsx("span",{children:"Total"}),r.jsxs("span",{className:"text-purple-600 dark:text-purple-400",children:["â‚¬",F.toFixed(2)]})]})]}),r.jsx("button",{type:"submit",disabled:c||!u||m,className:"w-full mt-6 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-bold hover:from-purple-700 hover:to-pink-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 whitespace-nowrap",children:c?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processando..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"ri-shopping-bag-line text-xl"}),"Finalizar Compra"]})}),r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4",children:[r.jsx("i",{className:"ri-shield-check-line"})," Pagamento seguro e protegido"]})]})})]})]})})}export{d as default};
